# Использование хранилища вне компонента

Хранилища Pinia полагаются на экземпляр `pinia` для совместного использования одного и того же экземпляра хранилища во всех вызовах. В большинстве случаев это работает из коробки, просто вызывая вашу функцию `useStore()`. Например, в `setup()` вам больше ничего не нужно делать. Но за пределами компонента все обстоит несколько иначе.
За кулисами `useStore()` _инжектирует_ экземпляр `pinia`, который вы передали своему `app`. Это означает, что если экземпляр `pinia` не может быть автоматически инжектирован, вы должны вручную предоставить его функции `useStore()`.
Вы можете решить эту проблему по-разному, в зависимости от типа приложения, которое вы пишете.

## Одностраничные приложения

Если вы не используете SSR (Server Side Rendering), любой вызов `useStore()` после установки плагина pinia с помощью `app.use(pinia)` будет работать:

```js
import { useUserStore } from '@/stores/user'
import { createApp } from 'vue'
import App from './App.vue'

// ❌  не удается, потому что он вызывается до создания pinia
const userStore = useUserStore()

const pinia = createPinia()
const app = createApp(App)
app.use(pinia)

// ✅ работает, потому что экземпляр pinia теперь активен
const userStore = useUserStore()
```

Самый простой способ убедиться, что это всегда применяется, - это _ограничить_ вызовы `useStore()`, поместив их в функции, которые всегда будут выполняться после установки pinia.

Давайте рассмотрим пример использования хранилища внутри навигационной защиты с помощью Vue Router:

```js
import { createRouter } from 'vue-router'
const router = createRouter({
  // ...
})

// ❌ В зависимости от порядка импорта это приведет к сбою
const store = useStore()

router.beforeEach((to, from, next) => {
  // мы хотели использовать хранилище здесь
  if (store.isLoggedIn) next()
  else next('/login')
})

router.beforeEach((to) => {
  // ✅это будет работать, потому что маршрутизатор начинает свою навигацию после того, как
  // маршрутизатор установлен и pinia тоже будет установлена
  const store = useStore()

  if (to.meta.requiresAuth && !store.isLoggedIn) return '/login'
})
```

## SSR приложения

При работе с Server Side Rendering вам придется передавать экземпляр `pinia` в `useStore()`. Это не позволит pinia делиться глобальным состоянием между различными экземплярами приложения.

Этому посвящен целый раздел в [SSR guide](/ssr/index.md), это лишь краткое объяснение:
